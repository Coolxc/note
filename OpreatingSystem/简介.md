### 操作系统的概念

裸机  =》  安装操作系统  =》  安装应用软件  =》  用户

**操作系统（Operating System, OS）**是指控制和管理计算机系统的硬件和软件资源，并合理的组织调度计算机的工作和资源的分配，以提供给用户和其他软件方便的接口和环境，它是计算机系统中最基本的系统软件

### 操作系统的特征

**并发：**两个事件在同一时间间隔内发生，这些事件宏观上是同时发生的，但微观上是交替发生的。所以操作系统中能存在多个运行着的程序。并发是操作系统最重要的一项技术，许多技术都以并发为前提

**并行：**两个或多个时间在同一时刻同时发生

**共享：**即资源共享，系统中的资源可供内存中多个并发执行的进程共同使用

> 互斥共享：同一时间段该资源只允许一个进程访问。如打印机
>
> 同时共享：允许一个时间段内由多个进程 "同时"  对该资源进行访问。这里的同时是宏观上的，微观上可能是采用的分时共享方式。如硬盘，各个进程可以宏观上同时访问

**并发和共享是相互依存的。没有并发性就不需要共享资源，一个一个来就好。没有共享性就无法完成并发，资源都不能共享了，并发交替执行也只能是一个进程运行其他进程等待资源。**

**虚拟：**将一个物理上的实体变为若干个逻辑上的对应物。物理实体是实际存在的，而逻辑上对应物是用户感受到的

> 空分复用技术：虚拟存储器、虚拟内存
>
> 时分复用技术：虚拟处理器

**异步：**在多道程序环境下，允许多个程序并发执行，但由于资源有限，进程的执行不是一贯到底的，而是走走停停的，以不可预知的速度向前推进，这就是进程的异步性

### 操作系统的发展和分类

##### 手工操作阶段

> 纸带机：由用户在纸带上打孔来描述二进制的01然后由计算机读取

##### 批处理阶段

> **单道批处理系统：**引入脱机输入/输出技术（磁带），并由监督程序负责控制作业的输入、输出。一次只能执行一道程序
> **多道批处理系统：**每次向内存中输入多道程序。这里操作系统正式诞生，并引入了中断技术，由操作系统负责管理这些程序的运行，各个程序并发执行。但是没有人机交互的功能，用户提交自己的作业后就只能等待计算机处理完成，中间不能控制自己的作业执行
>
> ![image-20200412092937525](C:\Users\Administrator\Desktop\oooooo\操作系统\图片\image-20200412092937525.png)

##### 分时操作系统

计算机以时间片为单位轮流为各个用户/作业服务，各个用户可通过终端与计算机进行交互。

**优点：**用户请求可以被立即相应，解决了人机交互问题。允许多个用户同时使用一台计算机，并且用户对计算机的操作相互独立，感受不到别人的存在

**缺点：**不能优先处理一些紧急任务。操作系统对各个用户/作业都是完全公平的，循环的为每个用户/作业服务一个时间片，不区分任务的紧急性

##### 实时操作系统

**优点：**能够响应一些紧急任务，某些紧急任务不需要时间片排队

在实时操作系统的控制下，计算机系统接收到外部信号后及时进行处理，并且在严格的时限内处理完事件。实时操作系统的主要特点是及时性和可靠性

实时操作系统分为

> 硬实时系统：必须在严格规定的时间内完成处理，如导弹控制系统
>
> 软实时系统：能接受偶尔违反时间规定，如买票系统

### 操作系统运行机制

**指令：**代码会编译为机器语言指令。指令是计算机底层的CPU能够识别的二进制序列。有的指令用户是不能直接调用的，所以使用程序状态字寄存器PSW中的某标志位来标识当前处理器处于什么状态（如0为用户态，1为核心态）然后根据身份判断权限

> **内核程序：**运行在核心态。操作系统的内核程序是系统的管理者。既可以执行特权指令也可以执行非特权指令
>
> **应用程序：**运行在用户态，为保证操作系统能安全运行，普通的应用程序只能执行非特权指令。

![image-20200412094827782](C:\Users\Administrator\Desktop\oooooo\操作系统\图片\image-20200412094827782.png)

内核是最底层的软件，实现操作系统内核功能的那些程序就是内核程序

##### 操作系统体系结构

![image-20200412095246587](C:\Users\Administrator\Desktop\oooooo\操作系统\图片\image-20200412095246587.png)

**大内核**

> 将操作系统的主要功能模块都作为系统内核，运行在核心态
>
> 优点：高性能
>
> 缺点：内核代码庞大，结构混乱，难以维护

**微内核**

> 只是把最基本的功能保留在内核
>
> 优点：内核功能少，结构清晰，方便维护
>
> 缺点：需要频繁的在核心态与用户态之间切换，性能低

**类比**

内核就是企业的管理层，只负责一些重要的工作。只有管理层才能执行特权指令，普通员工只能执行非特权指令。用户态、核心态之间的切换相当于普通员工和管理层之间的工作交接。

> 大内核：企业初创时体量不大，管理层的人会负责大部分的事情。有点事效率高，缺点是组织混乱
>
> 微内核：随着企业越来越大，管理层只负责最核心的一些工作。优点是组织结构清晰。缺点是效率低下，普通员工与管理层需要很多的工作交接形式

### 中断

发生中断就意味着需要操作系统介入，开展管理工作

**CPU执行中断过程**

>  CPU收到计时部件发出的中断信号，切换为核心态对中断进行处理
>
> 操作系统内核负责对中断信号进行处理
>
> 进程1的时间片已用尽，换成进程2运行
>
> 因为输入输出只能由操作系统操作。这时进程2发出系统调用（内中断信号）请求输出，CPU切换为核心态，对中断进行处理
>
> 操作系统内核对中断进行处理，调用打印机。进程2暂停运行等待IO完成，这时换进程3执行
>
> 当打印机IO完成后，打印机向CPU发出IO完成中断信号
>
> 切换为核心态。内核对中断进行处理，让进程2恢复运行已完成后续工作

**中断总结**

> 1. 当中断发生后CPU立即进入核心态，可以说中断是可以使CPU转换为核心态的唯一途径
>
> > 核心态 =》 用户态 的切换是通过执行一个特权指令，将程序状态字PSW的标志位设为 "用户态"
>
> 1. 当中断发生后，当前运行的进程暂停运行，并由操作系统内核对中断进行处理
> 2. 对于不同的中断信号，会进行不同的处理
>
> 发生了中断，就意味着需要操作系统介入开展管理工作。由于操作系统的管理工作（进程切换、分配IO等）需要特权指令，因此CPU要从用户态转换为核心态。中断可以使CPU从用户态切换为核心态，使操作系统获得计算机的控制权。有了中断，才能实现多道程序并发执行

### 系统调用

**系统调用：**是操作系统提供给应用程序（编程人员）使用的接口，可以理解为一种可供应用程序调用的特殊函数，应用程序可以发出系统调用请求来获得操作系统的服务。运行在核心态。

如用户进程想要使用打印机这种共享资源，只能通过系统调用向操作系统发出请求。操作系统会对每个请求进行协调管理，防止打印混文件。

**系统调用分类**

> 设备管理：完成设备的 请求、释放、启动等功能
>
> 文件管理：完成文件的 读、写、创建、删除等功能
>
> 进程控制：完成进程的 创建、撤销、阻塞、唤醒等功能
>
> 内存管理：完成内存的 分配、回收等功能

**系统调用和库函数的区别**

> 操作系统提供系统调用。用户应用程序调用库函数，库函数调用系统调用

![image-20200412105606875](C:\Users\Administrator\Desktop\oooooo\操作系统\图片\image-20200412105606875.png)